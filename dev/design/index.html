<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://microsoft.github.io/XmlNotepad/dev/design/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Design - XmlNotepad</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../css/main.css" rel="stylesheet">
    <link href="../../css/syntax.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "XML Notepad Design", url: "#_top", children: [
              {title: "Validation, IntelliSense, and Custom Editors", url: "#validation-intellisense-and-custom-editors" },
              {title: "Infinite Undo/Redo", url: "#infinite-undoredo" },
              {title: "Unit Testing", url: "#unit-testing" },
              {title: "Conclusion", url: "#conclusion" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="https://www.googletagmanager.com/gtag/js?id=UA-89203408-1"></script>
      <script src="https://consentdeliveryfd.azurefd.net/mscc/lib/v2/wcp-consent.js"></script>
      <script src="../../assets/js/cookies.js"></script>
      <script src="../../assets/js/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>

<div id="cookie-banner"></div>


<div class="wrapper wm-page-content">
  <div class="container-fluid">
    <a name="_top"></a>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav">
      <a href="../" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../" class="btn btn-xs btn-link">
        Overview
      </a>
    </div>
    
  </div>

      

      <h1 id="xml-notepad-design">XML Notepad Design<a class="headerlink" href="#xml-notepad-design" title="Permanent link">#</a></h1>
<p>By <a href="http://lovettsoftware.com/">Chris Lovett</a>, Microsoft</p>
<p>In the github repo you'll find the core <code>XmlNotepad</code> dll project, an <code>Application</code> project that builds
XmlNotepad.exe, and some setup projects like <code>XmlNotepadSetup</code> which builds the .msi
installer, and the <code>UnitTests</code> project for testing XML Notepad.</p>
<p>The following DGML diagram shows the relationships between the main UI classes. The main form contains all the UI
elements from the TaskList to the main XmlTreeView with Resizers in between; it's the launching point for the dialogs
such as FormSearch, FormSchemas, FormOption, and FormAbout.</p>
<p><img alt="ui" src="../../assets/images/ui.png" /></p>
<p>The main tab control contains the XmlTreeView and the XsltViewer for showing XSL output. The XmlTreeView
contains a TreeView on the left and a NodeTextView on the right and coordinates scrolling between these two views.
Both the TreeView and NodeTextView provide the same IntelliSense editing functionality using a TextEditorOverlay
component. The XmlTreeView implements IFindTarget, which is used by the Find dialog (FormSearch) to implement
find/replace functionality.</p>
<p><img alt="find" src="../../assets/images/ifindtarget.png" /></p>
<p>The Find dialog supports full text, regex, or XPath expressions and can filter by names or values.</p>
<h2 id="validation-intellisense-and-custom-editors">Validation, IntelliSense, and Custom Editors<a class="headerlink" href="#validation-intellisense-and-custom-editors" title="Permanent link">#</a></h2>
<p>The biggest new feature is IntelliSense, which is driven by XML Schema information provided via the SchemaCache.
For example, if your element or attribute is defined by an XSD simpleType and this simpleType contains a list of
enumeration facets, then you will get a drop-down like this:</p>
<p><img alt="intellisense" src="../../assets/images/intellisense.png" /></p>
<p>The way this works is that the Checker runs after each edit operation to validate the document and report errors in
the TaskList. This process also puts System.Xml.Schema.XmlSchemaType information on each element and attribute
in the XmlDocument; then, when editing the value of that node, the TextEditorOverlay uses the
XmlIntelliSenseProvider to get back a list of possible values. In the above example it returns the values from the
simpleType enumeration facets. For element name IntelliSense in the tree view, the XmlIntelliSenseProvider invokes
the Checker again, captures GetExpectedParticles and GetExpectedAttributes on the
System.Xml.Schema.XmlSchemaValidator, and uses that to provide IntelliSense.</p>
<p><img alt="plugins" src="../../assets/images/plugins.png" /></p>
<p>The TextEditorOverlay also supports custom editors like the DateTimeEditor or the UriBuilder or ColorBuilder. There
are two types of custom editors: IXmlEditors, which are inline editors that replace the default TextBox, and
IXmlBuilders, which are popup dialogs like the OpenFileDialog or ColorDialog. The type of editor is derived from the
schema type information â€” "xs:date", "xs:time", "xs:datetime" results in the DateTimeEditor, and "xs:anyURI" results
in the UriBuilder. You can also annotate the schema with a custom "vs:builder" attribute in the
"http://schemas.microsoft.com/Visual-Studio-IntelliSense" namespace. See the Help content for more information.</p>
<h2 id="infinite-undoredo">Infinite Undo/Redo<a class="headerlink" href="#infinite-undoredo" title="Permanent link">#</a></h2>
<p>To implement undo/redo XML Notepad follows a common design pattern of Command objects with Undo and Redo methods.
The UndoManager collects these in a list. Then the state of the UndoManager controls the enabled/disabled state of
the Undo/Redo MenuItems. When the user selects the Undo menu item, the Undo method is called on the active
command, and that command is pushed onto the Redo stack.</p>
<p><img alt="undo.png" src="../../assets/images/undo.png" /></p>
<p>Some operations in the editor cause many edits in the tree including the replace-all operation and editing the value
of a namespace attribute. (When you change the value of a namespace attribute. every XmlNode bound to that
namespace needs to be reconstructed with a new namespace URI, which can obviously affect a lot of nodes in the
tree!) So, to make these operations one atomic undo operation, there is a CompoundCommand object that contains
a list of smaller edit commands, and this CompoundCommand is put into the UndoManager.</p>
<p>Other simpler command objects include the following, which all operate on XmlTreeNode and XmlNode objects:</p>
<p><img alt="commands.png" src="../../assets/images/commands.png" /></p>
<p>The PasteCommand is special because it takes random XML text off the clipboard and parses it in context of the
currently selected element in the tree, inheriting the namespaces in scope. The helper class TreeData uses the special
XmlTextReader constructor that takes an XmlParserContext as input.</p>
<h2 id="unit-testing">Unit Testing<a class="headerlink" href="#unit-testing" title="Permanent link">#</a></h2>
<p>The UnitTest runs from the Test Explorer under the Test menu from within Visual Studio, and the unit tests will launch
multiple instances of XML Notepad while executing all the test methods.  It launches XML Notepad in a special way so it
has a consistent set of user settings.</p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">#</a></h2>
<p>Feedback and suggestions are welcome, just use the <a href="https://github.com/microsoft/XmlNotepad/issues">GitHub  issues
list</a>.  Pull requests are also welcome, in fact, a number of good pull
requests have already been merged.  Thanks to all who are helping to make XML notepad a great tool!</p>

    <br>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav">
      <a href="../" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../" class="btn btn-xs btn-link">
        Overview
      </a>
    </div>
    
  </div>

      <br>
  </div>
</div>

<footer class="wm-page-content">

  
<div class='footer-content'>
  <div class="container-fluid">
    <div class="col-sm-8 text-left footnote-copy">
       XML Notepad
    </div>
    <div class="col-sm-4 text-right footnote-copy">
      <ul class="list-unstyled list-inline">
        <li><a href="https://www.microsoft.com/" target="_blank"><img class="img-responsive" width="140" src="http://microsoft.github.io/XmlNotepad/assets/images/microsoft.svg" alt="Microsoft"> </a></li>
      </ul>
    </div>
  </div>
  <li><span id="copyright"></span></li>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/noraj/mkdocs-windmill-dark">Windmill Dark</a> theme by noraj.</p>
</div>

</footer>


<script type="text/javascript">
    $(document).ready(function () {
      $('table').each(function () {
        $(this).addClass("table");
        $(this).addClass("table-bordered");
        $(this).addClass("table-striped");
        $(this).addClass("table-condensed");
      });

    });
</script>

</body>
</html>